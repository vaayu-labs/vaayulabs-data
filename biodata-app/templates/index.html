<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collage Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-blue-900 mb-2">‚ú® Collage Maker</h1>
            <p class="text-blue-700 text-lg">Create stunning collages for Instagram, Reels & YouTube</p>
        </div>

        <!-- Template Preview Section -->
        <div class="mb-12 bg-white rounded-xl p-6 shadow-lg border border-blue-200">
            <h2 class="text-2xl font-bold text-blue-900 mb-4">Template Gallery</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="templateGrid">
                <!-- Template previews will be loaded here -->
            </div>
            <div class="mt-6 flex justify-end">
                <button onclick="generateBulkCollages()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 font-semibold transition-all transform hover:scale-105 text-sm flex items-center gap-2">
                    <span>üöÄ</span> Generate All Variations
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Left Sidebar - Controls -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Frame Type -->
                <div class="bg-white rounded-xl p-6 shadow-lg border border-blue-200">
                    <h3 class="text-blue-900 font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üìê</span> Frame Type
                    </h3>
                    <div class="space-y-3">
                        <button onclick="setFrame('post')" class="w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 font-semibold transition-all transform hover:scale-105 text-sm">
                            üì± Post (1:1)
                        </button>
                        <button onclick="setFrame('reel')" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 font-semibold transition-all transform hover:scale-105 text-sm">
                            üé¨ Reel (9:16)
                        </button>
                        <button onclick="setFrame('youtube')" class="w-full px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 font-semibold transition-all transform hover:scale-105 text-sm">
                            ‚ñ∂Ô∏è YouTube (16:9)
                        </button>
                        <button onclick="generateAllPhotosForCurrentVariant()" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 font-semibold transition-all transform hover:scale-105 text-sm flex items-center justify-center gap-2">
                            <span>üñºÔ∏è</span> Generate All Photos
                        </button>
                    </div>
                </div>

                <!-- Collage Layout -->
                <div class="bg-white rounded-xl p-6 shadow-lg border border-blue-200">
                    <h3 class="text-blue-900 font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üé®</span> Layout
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="setCollage(1)" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold transition-all text-sm">1 Photo</button>
                        <button onclick="setCollage(2)" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold transition-all text-sm">2 Photos</button>
                        <button onclick="setCollage(3)" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold transition-all text-sm">3 Photos</button>
                        <button onclick="setCollage(4)" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold transition-all text-sm">4 Photos</button>
                    </div>
                </div>

                <!-- Background Color -->
                <div class="bg-white rounded-xl p-6 shadow-lg border border-blue-200">
                    <h3 class="text-blue-900 font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üé≠</span> Background
                    </h3>
                    <div class="space-y-3">
                        <input type="color" id="bgColor" value="#ffffff" onchange="changeBgColor()" class="w-full h-12 rounded-lg cursor-pointer border border-slate-600">
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setBgColor('#ffffff')" class="h-10 bg-white rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                            <button onclick="setBgColor('#000000')" class="h-10 bg-black rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                            <button onclick="setBgColor('#f59e0b')" class="h-10 bg-amber-400 rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                            <button onclick="setBgColor('#ec4899')" class="h-10 bg-pink-500 rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                            <button onclick="setBgColor('#06b6d4')" class="h-10 bg-cyan-400 rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                            <button onclick="setBgColor('#8b5cf6')" class="h-10 bg-violet-500 rounded-lg border-2 border-slate-600 hover:border-slate-400"></button>
                        </div>
                    </div>
                </div>

                <!-- Download Button -->
                <button onclick="downloadImage()" class="w-full px-6 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl hover:from-emerald-600 hover:to-teal-700 font-bold text-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">‚¨áÔ∏è</span> Download PNG
                </button>
            </div>

            <!-- Center - Canvas -->
            <div class="lg:col-span-2 flex items-center justify-center">
                <div class="bg-white rounded-2xl p-8 shadow-2xl border border-blue-200">
                    <div id="canvas" class="bg-white rounded-xl shadow-inner relative" style="width: 400px;">
                        <!-- Biodata Header -->
                        <div class="text-center py-4">
                            <h2 class="text-lg font-bold text-gray-800">Create Your Marriage Biodata In 2 Mins</h2>
                            <div class="flex items-center justify-center gap-4 text-sm text-gray-800 pt-2 pb-2">
                                <span class="flex items-center text-white gap-1 px-4 py-1">
                                    <span class="text-lg">üîí</span> Secure
                                </span>
                                <span class="flex items-center text-white gap-1 px-4 py-1">
                                    <span class="text-lg">‚ú®</span> Simple
                                </span>
                            </div>
                            <span class="px-4 pt-2 rounded-full">
                                <a href="http://www.simplebiodatamaker.in" target="_blank" 
                                class="text-gray-800 font-semibold hover:text-green-600 transition-colors pb-2">
                                    www.simplebiodatamaker.in
                                </a>
                            </span>
                        </div>
                        
                        <!-- Content Container -->
                        <div id="container" class="w-full h-[400px] grid gap-2 p-4 px-16 rounded-[10px]"></div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Photos -->
            <div class="lg:col-span-1">
                <div class="bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700 h-full sticky top-6">
                    <h3 class="text-blue-900 font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üì∏</span> Photos
                    </h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-300 mb-3">Upload Images:</label>
                        <label class="flex items-center justify-center gap-2 px-4 py-3 bg-slate-700 border-2 border-dashed border-slate-500 rounded-lg cursor-pointer hover:border-slate-400 hover:bg-slate-600 transition-all">
                            <span class="text-2xl">üìÅ</span>
                            <span class="text-white font-semibold">Choose Files</span>
                            <input type="file" id="photoInput" multiple accept="image/*" class="hidden">
                        </label>
                    </div>

                    <div id="photoList" class="space-y-4 max-h-[600px] overflow-y-auto p-2">
                        <p class="text-slate-400 text-sm text-center py-8">No images loaded yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let loadedImages = [];
        let imageMetadata = {};  // Store metadata for each image
        let currentFrame = 'post';
        let collageType = 1;

        const frames = {
            post: { width: 1080, height: 1080 },
            reel: { width: 1080, height: 1920 },
            youtube: { width: 1920, height: 1080 }
        };

        document.getElementById('photoInput').addEventListener('change', (e) => {
            loadedImages = [];
            const files = e.target.files;
            let loaded = 0;
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    loadedImages.push(event.target.result);
                    loaded++;
                    if (loaded === files.length) updatePhotoList();
                };
                reader.readAsDataURL(file);
            }
        });

        function updatePhotoList() {
            const list = document.getElementById('photoList');
            if (loadedImages.length === 0) {
                list.innerHTML = '<p class="text-slate-400 text-sm text-center py-8">No images loaded yet</p>';
                return;
            }

            list.innerHTML = loadedImages.map((img, idx) => `
                <div class="bg-white rounded-lg p-4 border border-blue-200 hover:border-blue-300 transition-all">
                    <img src="${img}" class="w-full h-32 object-cover rounded-lg mb-3">
                        <button onclick="addImageToFrame(${idx})" class="w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 font-semibold transition-all flex items-center justify-center gap-2">
                            <span>‚ûï</span> Add to Collage
                        </button>
                </div>
            `).join('');
        }

        function setFrame(type) {
            currentFrame = type;
            const canvas = document.getElementById('canvas');
            const container = document.getElementById('container');
            if (type === 'post') {
                canvas.style.width = '400px';
                container.style.height = '400px';
            } else if (type === 'reel') {
                canvas.style.width = '350px';
                container.style.height = '620px';
            } else {
                canvas.style.width = '550px';
                container.style.height = '310px';
            }
        }

        function setCollage(count) {
            collageType = count;
            framePhotos = {};
            renderCollage();
        }

        function changeBgColor() {
            const color = document.getElementById('bgColor').value;
            document.getElementById('canvas').style.backgroundColor = color;
        }

        function setBgColor(color) {
            document.getElementById('bgColor').value = color;
            changeBgColor();
        }

        let framePhotos = {};

        function addImageToFrame(idx) {
            const slotIndex = Object.keys(framePhotos).length;
            if (slotIndex < collageType) {
                framePhotos[slotIndex] = loadedImages[idx];
                renderCollage();
            } else {
                alert('All slots filled! Change layout to add more photos.');
            }
        }

        function updateMetadata(imageIndex, field, value) {
            if (!imageMetadata[imageIndex]) {
                imageMetadata[imageIndex] = {};
            }
            imageMetadata[imageIndex][field] = value;
        }

        function renderCollage() {
            const container = document.getElementById('container');
            container.innerHTML = '';
            container.style.display = 'grid';
            
            // Set grid layout based on collage type
            if (collageType === 1) {
                container.style.gridTemplateColumns = '1fr';
            } else if (collageType === 2) {
                container.style.gridTemplateColumns = '1fr 1fr';
            } else if (collageType === 3 || collageType === 4) {
                container.style.gridTemplateColumns = '1fr 1fr';
                container.style.gridTemplateRows = '1fr 1fr';
            }

            if (collageType === 1) {
                for (let i = 0; i < 1; i++) {
                    const div = document.createElement('div');
                    div.className = 'w-full h-full rounded-lg overflow-hidden flex items-center justify-center';
                    if (framePhotos[i]) {
                        const metadata = imageMetadata[Object.keys(framePhotos).find(key => framePhotos[key] === framePhotos[i])] || {};
                        div.innerHTML = `
                            <div class="relative w-full h-full">
                                <img src="${framePhotos[i]}" class="w-full h-full object-contain">
                                ${metadata.title ? `
                                    <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2">
                                        <div class="font-semibold text-sm">${metadata.title}</div>
                                        ${metadata.tags ? `<div class="text-xs mt-1">${metadata.tags}</div>` : ''}
                                        ${metadata.url ? `<div class="text-xs text-blue-300 truncate">${metadata.url}</div>` : ''}
                                    </div>
                                ` : ''}
                            </div>`;
                    } else {
                        div.innerHTML = `<span class="text-gray-500 font-semibold">Add Photo</span>`;
                    }
                    container.appendChild(div);
                }
            } else if (collageType === 2) {
                for (let i = 0; i < 2; i++) {
                    const div = document.createElement('div');
                    div.className = 'w-1/2 h-full rounded-lg overflow-hidden flex items-center justify-center';
                    if (framePhotos[i]) {
                        div.innerHTML = `<img src="${framePhotos[i]}" class="w-full h-full object-contain">`;
                    } else {
                        div.innerHTML = `<span class="text-gray-500 font-semibold text-sm">Photo ${i+1}</span>`;
                    }
                    container.appendChild(div);
                }
            } else if (collageType === 3) {
                const div1 = document.createElement('div');
                div1.className = 'w-full h-1/2 rounded-lg overflow-hidden flex items-center justify-center';
                if (framePhotos[0]) {
                    div1.innerHTML = `<img src="${framePhotos[0]}" class="w-full h-full object-cover">`;
                } else {
                    div1.innerHTML = `<span class="text-gray-500 font-semibold">Photo 1</span>`;
                }
                container.appendChild(div1);

                for (let i = 1; i < 3; i++) {
                    const div = document.createElement('div');
                    div.className = 'w-1/2 h-1/2 rounded-lg overflow-hidden flex items-center justify-center';
                    if (framePhotos[i]) {
                        div.innerHTML = `<img src="${framePhotos[i]}" class="w-full h-full object-cover">`;
                    } else {
                        div.innerHTML = `<span class="text-gray-500 font-semibold text-sm">Photo ${i+1}</span>`;
                    }
                    container.appendChild(div);
                }
            } else if (collageType === 4) {
                for (let i = 0; i < 4; i++) {
                    const div = document.createElement('div');
                    div.className = 'w-1/2 h-1/2 rounded-lg overflow-hidden flex items-center justify-center';
                    if (framePhotos[i]) {
                        div.innerHTML = `<img src="${framePhotos[i]}" class="w-full h-full object-cover">`;
                    } else {
                        div.innerHTML = `<span class="text-gray-500 font-semibold text-sm">Photo ${i+1}</span>`;
                    }
                    container.appendChild(div);
                }
            }
        }

        function downloadImage() {
            if (Object.keys(framePhotos).length === 0) {
                alert('Please add at least one image!');
                return;
            }

            const canvas = document.getElementById('canvas');
            html2canvas(canvas, { scale: 2, useCORS: true, backgroundColor: null }).then((canvasElement) => {
                const link = document.createElement('a');
                link.href = canvasElement.toDataURL('image/png');
                link.download = `collage-${currentFrame}-${Date.now()}.png`;
                link.click();
            });
        }

        // Template preview and bulk generation functions
        function loadTemplateGrid() {
            const grid = document.getElementById('templateGrid');
            const templates = [
                { name: '1 Photo', layout: 1 },
                { name: '2 Photos Vertical', layout: 2 },
                { name: '2 Photos Horizontal', layout: 2 },
                { name: '3 Photos Grid', layout: 3 },
                { name: '4 Photos Grid', layout: 4 }
            ];

            grid.innerHTML = templates.map((template, idx) => `
                <div class="bg-blue-50 rounded-lg p-4 border border-blue-200 hover:border-blue-400 transition-all">
                    <div class="aspect-square bg-white rounded-lg mb-3 p-2">
                        <div class="w-full h-full border-2 border-dashed border-blue-300 rounded-lg flex items-center justify-center">
                            <span class="text-blue-400 text-sm font-semibold">${template.name}</span>
                        </div>
                    </div>
                    <button onclick="applyTemplate(${template.layout})" class="w-full px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm rounded font-semibold hover:from-blue-600 hover:to-blue-700 transition-all">
                        Use Template
                    </button>
                </div>
            `).join('');
        }

        function applyTemplate(layout) {
            setCollage(layout);
            document.getElementById('canvas').scrollIntoView({ behavior: 'smooth' });
        }

        async function generateAllPhotosForCurrentVariant() {
            if (loadedImages.length === 0) {
                alert('Please upload some images first!');
                return;
            }

            // Calculate how many sets we can make with the current layout
            const totalSets = Math.floor(loadedImages.length / collageType);
            if (totalSets === 0) {
                alert(`Please upload at least ${collageType} photos for the current layout`);
                return;
            }

            // Show progress indicator
            const downloadBtn = document.querySelector('button[onclick="generateAllPhotosForCurrentVariant()"]');
            const originalText = downloadBtn.innerHTML;
            downloadBtn.innerHTML = '<span>‚è≥</span> Generating...';
            downloadBtn.disabled = true;

            try {
                // Generate collages for each set of photos
                for (let i = 0; i < totalSets; i++) {
                    // Clear previous photos
                    framePhotos = {};
                    
                    // Add photos for this set
                    for (let j = 0; j < collageType; j++) {
                        const photoIndex = i * collageType + j;
                        if (photoIndex < loadedImages.length) {
                            framePhotos[j] = loadedImages[photoIndex];
                        }
                    }
                    
                    renderCollage();
                    
                    // Wait for render
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Download
                    await downloadImage(true, `set_${i + 1}`);
                }

                alert('All collages have been generated!');
            } catch (error) {
                alert('Error generating collages. Please try again.');
                console.error(error);
            } finally {
                // Restore button
                downloadBtn.innerHTML = originalText;
                downloadBtn.disabled = false;
            }
        }

        async function generateBulkCollages() {
            if (loadedImages.length === 0) {
                alert('Please upload some images first!');
                return;
            }

            const layouts = [1, 2, 3, 4];
            const frames = ['post', 'reel', 'youtube'];
            
            for (let layout of layouts) {
                for (let frame of frames) {
                    setFrame(frame);
                    setCollage(layout);
                    
                    // Randomly select images for this layout
                    framePhotos = {};
                    for (let i = 0; i < layout; i++) {
                        framePhotos[i] = loadedImages[i % loadedImages.length];
                    }
                    renderCollage();
                    
                    // Wait a bit for the render to complete
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Download the image
                    await downloadImage(true);
                }
            }
        }

        async function downloadImage(isBulk = false, setName = '') {
            if (Object.keys(framePhotos).length === 0) {
                if (!isBulk) alert('Please add at least one image!');
                return;
            }

            const canvas = document.getElementById('canvas');
            const canvasElement = await html2canvas(canvas, { scale: 2, useCORS: true, backgroundColor: null });
            const link = document.createElement('a');
            link.href = canvasElement.toDataURL('image/png');
            const filename = setName ? 
                `biodata-${currentFrame}-${setName}-${Date.now()}.png` : 
                `biodata-${currentFrame}-${Date.now()}.png`;
            link.download = filename;
            link.click();
        }

        // Initialize
        setFrame('post');
        changeBgColor();
        loadTemplateGrid();
    </script>
</body>
</html>